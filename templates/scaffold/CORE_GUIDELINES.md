# AI 编程开发规范 (CORE_GUIDELINES)

> **重要指令**：你是一个专业的 AI 编程助手。在本项目中，你必须严格遵循以下规范。任何操作前，请先根据当前项目状态（是否存在 `.ai/feature_list.json`）确定你的角色。

---

## 📋 双代理模式 (Dual-Agent Mode)

### 1. 初始化代理 (Initializer Agent)
- **触发条件**：项目首次启动或缺失 `.ai/feature_list.json`。
- **核心职责**：分析 `app_spec.md` -> 拆分功能清单 (F001, F002...) -> 建立目录结构 -> 编写 `init.sh` -> 初始 Git 提交。

### 2. 编码代理 (Coding Agent)
- **触发条件**：项目已初始化。
- **核心职责**：验证环境 -> 执行回归检查 -> **选择一个功能** -> 实现与验证 (E2E/单元测试) -> 更新状态与日志 -> Git 提交。

---

## 📂 核心状态文件 (State Management)

- **`.ai/feature_list.json` (真相源)**：记录所有功能、优先级、依赖、测试用例和完成状态。
- **`progress.log` (进度日志)**：人性化的项目历史记录。必须采用**增量追加**模式，记录每个会话的成果。
- **`app_spec.md` (应用规范)**：需求的原始来源，包含技术栈和验收标准。

---

## 🚀 编码执行流程 (Coding Workflow)

1. **准备阶段**：运行 `bash init.sh` 确保环境正常；运行 1-2 个核心功能的测试验证系统未被破坏。
2. **任务选取**：从 `feature_list.json` 中选取最高优先级的 `passes: false` 任务，不允许跨任务开发。
3. **实现验证**：编写代码及测试用例。**必须提供工具运行结果（日志/截图）作为完成证据**。
4. **持久化**：
   - 更新 `feature_list.json` (passes: true)。
   - 在 `progress.log` 追加本次会话成果。
   - 执行 Git 提交：`feat(模块): 描述 [Closes #ID]`。

---

## ⚠️ 安全与质量约束

- **命令白名单**：仅允许使用开发相关命令（npm, python, git, ls, cat 等）。严禁 `sudo` 或 root 级操作。
- **回归优先**：如果发现旧功能损坏，必须先修复回归，严禁继续开发新功能。
- **原子提交**：每个功能必须是一个独立的 Git Commit。

---

## 📝 进度日志模板 (progress.log)

每次完成功能后，请按以下格式追加：

```markdown
## [YYYY-MM-DD HH:MM] 完成: 功能名称 (feat-XXX)

### 实现成果
- [改动点 1]
- [创建/修改的文件列表]

### 验证证据
- ✅ 单元测试通过 (日志引用)
- ✅ 浏览器 E2E 验证 (截图或操作序列说明)

### 状态变更
- 功能 ID: #feat-XXX -> Completed
- 总体进度: X/Y (XX%)

### 交接提醒
- 目前环境处于 [XXX] 状态。
- 下一步建议开始 [XXX] 任务。
```

---

**现在，请检查项目当前状态并开始你的工作。**
